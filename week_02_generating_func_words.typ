#set document(title: "Производящие функции: алгебраический подход")
#set page(paper: "a4", margin: 2cm)
#set text(lang: "ru", font: "New Computer Modern", size: 11pt)
#set par(justify: true, leading: 0.65em)
#show selector(<nonumber>): set heading(numbering: none)

#align(center)[
  #text(size: 16pt, weight: "bold")[
    Производящие функции: от алгебры к вероятности
  ]
  #v(0.5em)
  #text(size: 12pt)[Алгебраический подход через операции на символах]
]

#v(1em)

= Алгебра символов

Рассмотрим два символа (буквы):
- $H$ — орёл (heads)
- $T$ — решка (tails)

Определим на множестве символов две операции:

#box(
  width: 100%,
  fill: rgb("#e8f4f8"),
  inset: 10pt,
  radius: 4pt,
)[
  *Операция сложения ($+$):* Дизъюнктное объединение (выбор одного из вариантов)
  
  $H + T$ означает "либо $H$, либо $T$"
  
  *Операция умножения ($dot$):* Конкатенация (последовательное присоединение)
  
  $H dot T$ означает "сначала $H$, потом $T$" (слово $H T$)
]

== Свойства операций

*Коммутативность сложения:*
$
  H + T = T + H
$

*Ассоциативность:*
$
  (H + T) + H = H + (T + H)
$

*Некоммутативность умножения* (если различаем порядок):
$
  H dot T ≠ T dot H quad "(слова" H T "и" T H "различны)"
$

Но для *подсчёта количества* порядок в умножении можно игнорировать, если нас интересует только комбинаторика.

== Примеры выражений

*Один бросок:*
$
  f_1 (H, T) = H + T
$

Это множество $\{H, T\}$ — два возможных исхода.

*Два броска:*
$
  f_2 (H, T) = (H + T) dot (H + T) = (H + T)^2
$

Раскрывая:
$
  (H + T)^2 = H H + H T + T H + T T
$

Множество исходов: $\{H H, H T, T H, T T\}$ — четыре элемента.

*Десять бросков:*
$
  f_(10) (H, T) = (H + T)^(10)
$

= Подсчёт количества элементов


Чтобы узнать, *сколько элементов* в множестве исходов, подставим $H = 1$ и $T = 1$:

$
  |Omega| = f(1, 1) = (1 + 1)^(10) = 2^(10) = 1024
$

#box(
  width: 100%,
  fill: rgb("#e8f8e8"),
  inset: 10pt,
  radius: 4pt,
)[
  === Общий случай: $n$ символов

Если есть $k$ различных символов $s_1, s_2, ..., s_k$ и делаем $n$ выборов:

$
  f(s_1, ..., s_k) = (s_1 + ... + s_k)^n
$

Количество исходов:
$
  f(1, ..., 1) = k^n
$
]

= Запись множества исходов через производящую функцию

== Полное множество исходов для 10 бросков

Множество всех последовательностей:
$
  Omega = {H H H H H H H H H H, H H H H H H H H H T, ..., T T T T T T T T T T}
$

Вместо явного перечисления 1024 элементов запишем компактно:

#box(
  width: 100%,
  fill: rgb("#fff4e6"),
  inset: 10pt,
  radius: 4pt,
)[
  *Производящая функция множества исходов:*
  
  $ f(H, T) = (H + T)^(10) $
  
  При раскрытии скобок каждый моном соответствует одному исходу.

$
  (H+T)^(10) = sum_(k=0)^(10) binom(10, k) H^k T^(10-k)
$

Интерпретация члена $binom(10, k) H^k T^(10-k)$: Ровно $k$ орлов и $(10-k)$ решек и таких исходов $binom(10, k)$ штук
]

== Примеры с ограничениями

*Пример 1:* В 3-м и 4-м бросках выпали *разные* стороны.

Ограничение: (3-й бросок = $H$ И 4-й = $T$) ИЛИ (3-й = $T$ И 4-й = $H$)

$
  b(H, T) = (H+T) dot (H+T) dot (H dot T + T dot H) dot (H+T)^6
$

Упрощаем:
$
  b(H, T) = (H+T)^2 dot (H T + T H) dot (H+T)^6
$

Количество таких исходов:
$
  b(1, 1) = 2^2 dot (1 + 1) dot 2^6 = 4 dot 2 dot 64 = 512
$

*Пример 2:* Первые три броска дали $H T H$.

$
  g(H, T) = H dot T dot H dot (H+T)^7
$

Количество исходов:
$
  g(1,1) = 1 dot 1 dot 1 dot 2^7 = 128
$

*Пример 3:* Ровно 5 орлов.

Нужен коэффициент при $H^5 T^5$ в $(H+T)^(10)$:
$
  [H^5 T^5] (H+T)^(10) = binom(10, 5) = 252
$

= Введение вероятностей

Пусть монетка *несимметричная*:
- $P(H) = p = 1/3$
- $P(T) = q = 1-p = 2/3$

Теперь *интерпретируем операции вероятностно:*

#box(
  width: 100%,
  fill: rgb("#e8f4f8"),
  inset: 10pt,
  radius: 4pt,
)[
  *Вероятностная интерпретация:*
  
  Сложение ($+$) $→$ сложение вероятностей (несовместные события)
  
  Умножение ($dot$) $→$ умножение вероятностей (независимые события)
]

== Вероятность конкретного исхода

*Исход* $H H T H T T T H T T$:

Вероятность этого конкретного исхода:
$
  P(H H T H T T T H T T) = p dot p dot q dot p dot q dot q dot q dot p dot q dot q
$
$
  = p^4 q^6 = (1/3)^4 (2/3)^6
$

#box(
  width: 100%,
  fill: rgb("#fff4e6"),
  inset: 10pt,
  radius: 4pt,
)[
*Общая формула:* Любой исход с $k$ орлами и $(10-k)$ решками:
$
  P("конкретный исход с" k "орлами") = p^k q^(10-k)
$
]

== Вероятность события через производящую функцию

*Вероятность хотя бы одного исхода:*

Подставим $H = p$, $T = q$ в производящую функцию:
$
  f(p, q) = (p + q)^(10) = (1/3 + 2/3)^(10) = 1^(10) = 1
$

Это проверка: сумма вероятностей всех исходов = 1 ✓

*Вероятность ровно $k$ орлов:*

$
  P(X = k) = binom(10, k) p^k q^(10-k)
$

Это коэффициент при "$H^k T^(10-k)$" после подстановки $H → p$, $T → q$.

#box(
  width: 100%,
  fill: rgb("#e8f8e8"),
  inset: 10pt,
  radius: 4pt,
)[
  *Вероятностная производящая функция:*
  
  $ f(p, q) = (p + q)^(10) = sum_(k=0)^(10) binom(10, k) p^k q^(10-k) $
  
  При $p + q = 1$ получаем $f(p, q) = 1$
]

== Примеры вычислений

*Вероятность ровно 5 орлов:*
$
  P(X = 5) = binom(10, 5) (1/3)^5 (2/3)^5 = 252 dot 1/243 dot 32/243 = 252 dot 32/59049 ≈ 0.136
$

*Вероятность, что в 3-м и 4-м бросках разные стороны:*

$
  b(p, q) = (p+q)^2 (p q + q p) (p+q)^6 = 1 dot 2 p q dot 1 = 2 p q
$
$
  = 2 dot 1/3 dot 2/3 = 4/9 ≈ 0.444
$

#pagebreak()

= Переход к числовым характеристикам

До этого работали с *вероятностями событий*. Теперь хотим найти числовые характеристики случайной величины $N_H = X$ — количества выпавших орлов $H$, то есть ищем $E[X]$ и $V a r (X)$

== Введение переменной для подсчёта

Вместо простой записи $H$ и $T$ введём *веса*:
- $H$ имеет вес 1 (даёт вклад в счётчик орлов)
- $T$ имеет вес 0 (не даёт вклад)

Но для производящих функций удобнее:
- Заменим $H → z$ (формальная переменная)
- Заменим $T → 1$ (нейтральный элемент)

Получим *производящую функцию для подсчёта орлов*.

== Set Generating Function (комбинаторная ПФ)

#box(
  width: 100%,
  fill: rgb("#fff4e6"),
  inset: 10pt,
  radius: 4pt,
)[
  *Определение:* Set Generating Function (SGF) кодирует количество способов получить $k$ орлов.
  
  $ G(z) = (z + 1)^(10) = sum_(k=0)^(10) binom(10, k) z^k $
  
  Коэффициент $[z^k] G(z) = binom(10, k)$ — число способов получить $k$ орлов.
]

*Пример:* Коэффициент при $z^5$:
$
  [z^5] (z+1)^(10) = binom(10, 5) = 252
$

*Подсчёт всех исходов:*
$
  G(1) = (1+1)^(10) = 2^(10) = 1024
$

== Probability Generating Function (вероятностная ПФ)

Теперь совместим вероятности и подсчёт:
- Заменим $H → p z$ (вероятность $p$ и вклад в счётчик $z$)
- Заменим $T → q dot 1$ (вероятность $q$, вклад 0)

#box(
  width: 100%,
  fill: rgb("#e8f8e8"),
  inset: 10pt,
  radius: 4pt,
)[
  *Определение:* Probability Generating Function (PGF)
  
  $ G_X (z) = (p z + q)^(10) = sum_(k=0)^(10) binom(10, k) p^k q^(10-k) z^k $
  
  Коэффициент $[z^k] G_X (z) = P(X = k)$
  
  Также: $G_X (z) = EE(z^X)$
]

*Для нашего примера* ($p = 1/3$, $q = 2/3$):
$
  G_X (z) = (z/3 + 2/3)^(10) = ((z+2)/3)^(10)
$

*Проверка нормировки:*
$
  G_X (1) = ((1+2)/3)^(10) = 1^(10) = 1 quad checkmark
$

== Связь с математическим ожиданием

*Первая производная PGF:*

$
  G'_X (z) = sum_(k=0)^(10) k dot P(X=k) z^(k-1)
$

При $z = 1$:
$
  G'_X (1) = sum_(k=0)^(10) k dot P(X=k) = EE(X)
$

*Вычисление для нашего примера:*

$
  G_X (z) = ((z+2)/3)^(10)
$

$
  G'_X (z) = 10 ((z+2)/3)^9 dot 1/3 = 10/3 ((z+2)/3)^9
$

$
  G'_X (1) = 10/3 dot 1^9 = 10/3
$

#box(
  width: 100%,
  fill: rgb("#e8f8e8"),
  inset: 10pt,
  radius: 4pt,
)[
  *Математическое ожидание:*
  
  $ EE(X) = G'_X (1) = 10/3 ≈ 3.33 $
  
  Проверка: $EE(X) = n p = 10 dot 1/3 = 10/3$ ✓
]

*Вторая производная для дисперсии:*

$
  G''_X (z) = 10/3 dot 9 ((z+2)/3)^8 dot 1/3 = 30/9 ((z+2)/3)^8 = 10/3 ((z+2)/3)^8
$

$
  G''_X (1) = 10/3 dot 1^8 = 10/3
$

Но $G''_X (1) = EE(X(X-1)) = EE(X^2) - EE(X)$:

$
  EE(X^2) = 10/3 + 10/3 = 20/3
$

$
  "Var"(X) = EE(X^2) - (EE(X))^2 = 20/3 - (10/3)^2 = 20/3 - 100/9 = 60/9 - 100/9 = -40/9
$

Ошибка! Пересчитаем:

$
  G''_X (z) = d/ \dz [10/3 ((z+2)/3)^9] = 10/3 dot 9 ((z+2)/3)^8 dot 1/3 = 10 ((z+2)/3)^8
$

$
  G''_X (1) = 10 dot 1 = 10
$

$
  EE(X^2) = 10 + 10/3 = 40/3
$

$
  "Var"(X) = 40/3 - 100/9 = 120/9 - 100/9 = 20/9 ≈ 2.22
$

Проверка: $"Var"(X) = n p q = 10 dot 1/3 dot 2/3 = 20/9$ ✓

= Moment Generating Function

== Переход от дискретной к непрерывной переменной

PGF работает только для *целочисленных* неотрицательных случайных величин. Для более общего подхода заменим $z$ на $e^t$:

#box(
  width: 100%,
  fill: rgb("#fff4e6"),
  inset: 10pt,
  radius: 4pt,
)[
  *Определение:* Moment Generating Function (MGF)
  
  $ M_X (t) = EE(e^(t X)) = G_X (e^t) $
  
  Для нашего случая:
  $ M_X (t) = (p e^t + q)^(10) = (e^t / 3 + 2/3)^(10) = ((e^t + 2)/3)^(10) $
]

== Извлечение моментов через производные

*Разложение в ряд:*

$
  e^(t X) = sum_(n=0)^∞ (t^n X^n)/(n!)
$

$
  M_X (t) = EE(e^(t X)) = sum_(n=0)^∞ (t^n)/(n!) EE(X^n)
$

При дифференцировании:

$
  (d^n M_X)/(d t^n) |_(t=0) = EE(X^n)
$

#box(
  width: 100%,
  fill: rgb("#e8f8e8"),
  inset: 10pt,
  radius: 4pt,
)[
  *Главное свойство MGF:*
  
  $n$-я производная в нуле = $n$-й момент:
  
  $ EE(X^n) = M_X^((n)) (0) $
]

== Вычисление моментов

*Первый момент:*

$
  M_X (t) = ((e^t + 2)/3)^(10)
$

$
  M'_X (t) = 10 ((e^t + 2)/3)^9 dot e^t/3
$

$
  M'_X (0) = 10 ((1+2)/3)^9 dot 1/3 = 10 dot 1 dot 1/3 = 10/3
$

$
  EE(X) = 10/3 quad checkmark
$

*Второй момент:*

$
  M''_X (t) = 10/3 [9 ((e^t+2)/3)^8 dot e^t/3 dot e^t + ((e^t+2)/3)^9 dot e^t]
$

$
  M''_X (0) = 10/3 [9 dot 1 dot 1/3 + 1] = 10/3 [3 + 1] = 40/3
$

$
  EE(X^2) = 40/3 quad checkmark
$

*Третий момент:*

Аналогично можно найти $EE(X^3) = M'''_X (0)$.

== Преимущество MGF

#enum(
  numbering: "1.",
  
  [Работает для *любых* случайных величин (не только целочисленных)],
  
  [Прямое вычисление всех моментов через производные],
  
  [Для *суммы независимых* с.в.: $M_(X+Y) (t) = M_X (t) dot M_Y (t)$],
)

*Пример:* Если $X_1, ..., X_(10)$ — независимые броски, $X = X_1 + ... + X_(10)$:

$
  M_X (t) = product_(i=1)^(10) M_(X_i) (t) = (M_(X_1) (t))^(10)
$

где $M_(X_i) (t) = p e^t + q$ (MGF одного броска Бернулли).

$
  M_X (t) = (p e^t + q)^(10) quad checkmark
$

= Характеристическая функция

== Проблема существования MGF

MGF может *не существовать* для некоторых распределений!

*Пример:* Распределение Коши не имеет конечных моментов, и $EE(e^(t X)) = ∞$ для $t ≠ 0$.

*Решение:* Заменим $e^t$ на $e^(i t)$, где $i = sqrt(-1)$.

== Определение характеристической функции

#box(
  width: 100%,
  fill: rgb("#fff4e6"),
  inset: 10pt,
  radius: 4pt,
)[
  *Определение:* Характеристическая функция (ХФ)
  
  $ phi_X (t) = EE(e^(i t X)) = M_X (i t) $
  
  Для нашего случая:
  $ phi_X (t) = (p e^(i t) + q)^(10) = (e^(i t)/3 + 2/3)^(10) = ((e^(i t) + 2)/3)^(10) $
]

== Всегда существует!

$
  |phi_X (t)| = |EE(e^(i t X))| ≤ EE(|e^(i t X)|) = EE(1) = 1
$

#box(
  width: 100%,
  fill: rgb("#e8f8e8"),
  inset: 10pt,
  radius: 4pt,
)[
  *Важнейшее свойство:* ХФ существует для *любого* распределения!
  
  $ |phi_X (t)| ≤ 1 quad "для всех" t $
]

== Извлечение моментов

Если $EE(|X|^n) < ∞$:

$
  EE(X^n) = 1/i^n (d^n phi_X)/(d t^n) |_(t=0)
$

*Первый момент:*

$
  phi'_X (t) = 10 ((e^(i t) + 2)/3)^9 dot (i e^(i t))/3
$

$
  phi'_X (0) = 10 dot 1 dot i/3 = (10 i)/3
$

$
  EE(X) = 1/i dot (10i)/3 = 10/3 quad checkmark
$

*Второй момент:*

$
  EE(X^2) = 1/i^2 phi''_X (0) = -phi''_X (0)
$

После вычислений:
$
  phi''_X (0) = -40/3
$

$
  EE(X^2) = -(-40/3) = 40/3 quad checkmark
$

== Формула Эйлера и геометрическая интерпретация

$
  e^(i t) = cos(t) + i sin(t)
$

$
  phi_X (t) = ((cos(t) + i sin(t) + 2)/3)^(10)
$

Можно переписать:
$
  e^(i t) + 2 = 2 + cos(t) + i sin(t)
$

Модуль:
$
  |e^(i t) + 2| = sqrt((2 + cos(t))^2 + sin^2(t))
$

*При $t = 0$:*
$
  phi_X (0) = ((1+2)/3)^(10) = 1
$

*График:* ХФ — комплекснозначная функция, её можно изобразить на комплексной плоскости.

#pagebreak()

= Взаимосвязь всех производящих функций

#table(
  columns: 4,
  stroke: 0.5pt,
  inset: 8pt,
  align: (left, center, left, left),
  fill: (col, row) => if row == 0 { rgb("#e8f4f8") } else if calc.odd(row) { rgb("#f9f9f9") },
  
  [*Функция*], [*Аргумент*], [*Определение*], [*Для 10 бросков*],
  
  [SGF], [$z$], [$sum_k binom(n,k) z^k$], [$(z+1)^(10)$],
  
  [PGF], [$z$], [$sum_k P(X=k) z^k = EE(z^X)$], [$(p z + q)^(10)$],
  
  [MGF], [$t$], [$EE(e^(t X))$], [$(p e^t + q)^(10)$],
  
  [ХФ], [$t$], [$EE(e^(i t X))$], [$(p e^(i t) + q)^(10)$],
)

#v(1em)

*Связи между функциями:*

$
  G_X (z) &= "PGF" \
  M_X (t) &= G_X (e^t) = "MGF" \
  phi_X (t) &= M_X (i t) = G_X (e^(i t)) = "ХФ"
$

#v(1em)

#box(
  width: 100%,
  fill: rgb("#fff4e6"),
  inset: 12pt,
  radius: 4pt,
)[
  *Цепочка обобщений:*
  
  $ "Комбинаторика" →^("вероятности") "PGF" →^(z → e^t) "MGF" →^(t → i t) "ХФ" $
  
  Каждый следующий шаг расширяет область применимости, но сохраняет структуру.
]

= Ключевые свойства и теоремы

== Свойство 1: Однозначность

#box(
  width: 100%,
  fill: rgb("#e8f8e8"),
  inset: 10pt,
  radius: 4pt,
)[
  *Теорема (Леви):* Характеристическая функция *однозначно определяет* распределение.
  
  Если $phi_X (t) = phi_Y (t)$ для всех $t$, то $X$ и $Y$ имеют одинаковое распределение.
]

Это не всегда верно для MGF (может не существовать), но ХФ всегда работает!

== Свойство 2: Сумма независимых случайных величин

Для независимых $X$ и $Y$:

$
  phi_(X+Y) (t) = phi_X (t) dot phi_Y (t)
$

*Доказательство:*

$
  phi_(X+Y) (t) = EE(e^(i t(X+Y))) = EE(e^(i t X) e^(i t Y)) = EE(e^(i t X)) dot EE(e^(i t Y)) = phi_X (t) phi_Y (t)
$

*Применение:* Если $X = X_1 + ... + X_n$, где $X_i$ независимы и одинаково распределены:

$
  phi_X (t) = [phi_(X_1) (t)]^n
$

Для биномиального распределения:
$
  phi_(X_1) (t) = p e^(i t) + q
$
$
  phi_X (t) = (p e^(i t) + q)^n
$

== Свойство 3: Формула обращения

Можно *восстановить* распределение по ХФ!

Для дискретной с.в.:
$
  P(X = k) = 1/(2pi) integral_(-pi)^pi e^(-i k t) phi_X (t) d t
$

*Проверка для нашего примера* ($k = 5$, $p = 1/3$):

$
  P(X = 5) = 1/(2pi) integral_(-pi)^pi e^(-5 i t) ((e^(i t) + 2)/3)^(10) d t
$

Это интегрирование даёт:
$
  P(X = 5) = binom(10, 5) (1/3)^5 (2/3)^5
$

= Применение к Центральной предельной теореме

== Формулировка

Пусть $X_1, X_2, ...$ — независимые одинаково распределённые с.в. с $EE(X_i) = mu$, $"Var"(X_i) = sigma^2 > 0$.

Стандартизованная сумма:
$
  Z_n = (X_1 + ... + X_n - n mu)/(sigma sqrt(n)) = (S_n - n mu)/(sigma sqrt(n))
$

*ЦПТ:* $Z_n$ сходится по распределению к $cal(N)(0,1)$.

== Доказательство через характеристические функции

ХФ стандартного нормального распределения:
$
  phi_(cal(N)(0,1)) (t) = e^(-t^2 / 2)
$

Нужно показать:
$
  phi_(Z_n) (t) → e^(-t^2/2) quad "при" n → ∞
$

*Для нашего примера:* $X_i tilde "Bernoulli"(p)$, $mu = p$, $sigma^2 = p q$.

$
  Z_n = (S_n - n p)/(sqrt(n p q))
$

ХФ одного броска:
$
  phi_(X_i - p) (t) = e^(-i p t) (p e^(i t) + q) = e^(-i p t) (p e^(i t) + 1 - p)
$

Для стандартизованной:
$
  phi_((X_i - p)/sqrt(p q)) (t) = e^(-i p t / sqrt(p q)) (p e^(i t / sqrt(p q)) + q)
$

При больших $n$ и малых аргументах ($t / sqrt(n)$):

$
  phi_(Z_n) (t) = [phi_((X_1 - p)/sqrt(p q)) (t/sqrt(n))]^n → e^(-t^2/2)
$

#box(
  width: 100%,
  fill: rgb("#e8f8e8"),
  inset: 12pt,
  radius: 4pt,
)[
  *Вывод ЦПТ:* Сходимость ХФ $arrow.l.r.double$ сходимость распределений
  
  Это мощный инструмент для доказательства предельных теорем!
]



= Заключение


#v(1em)

#align(center)[
  #box(
    width: 90%,
    fill: rgb("#fff4e6"),
    inset: 12pt,
    radius: 4pt,
  )[
    
    Вместо прямой работы с вероятностями, мы кодируем информацию в производящих функциях. Алгебраические операции над символами становятся операциями над функциями. Дифференцирование функций даёт нам моменты распределения. Предельный переход функций соответствует предельным теоремам для распределений.
    
    Производящие функции — это *язык*, на котором теория вероятности говорит с математическим анализом.
  ]
]
