#import "@preview/cetz:0.4.2": canvas, draw

#set page(paper: "a4", margin: 25mm)
#set text(lang: "ru", font: "New Computer Modern", size: 11pt)
#set par(justify: true, leading: 0.65em)
#show selector(<nonumber>): set heading(numbering: none)

#align(center)[
  #text(size: 17pt, weight: "bold")[Хитрый лис Иссерлис]
  #v(0.3em)
  #text(size: 11pt)[Моменты произведений координат гауссовского вектора]
]

#v(1em)

= Постановка задачи

Пусть случайный вектор $bold(X) = (X_1, X_2, dots, X_n)$ распределён нормально:
$
bold(X) tilde cal(N)_n (bold(mu), bold(C)),
$
где $bold(mu) = (mu_1, dots, mu_n)^top$ — вектор средних, 
$bold(C) = [C_(i j)]$ — ковариационная матрица.

*Базовое соотношение:*
$
E[X_i X_j] = mu_i mu_j + C_(i j)
$

*Задача:* найти $E[X_1 X_2 dots.c X_n]$ для произвольного $n$.


= Формула Иссерлиса (предварительная формулировка)

#box(
  width: 100%,
  fill: rgb("#e8f4f8"),
  inset: 12pt,
  radius: 4pt,
)[
  *Утверждение:* Для гауссовского вектора
  $
  E[X_1 X_2 dots.c X_n] = h(bold(mu), bold(C))
  $
  где $h$ — полином, состоящий из слагаемых вида:
  $
  mu_(i_1) mu_(i_2) dots.c mu_(i_k) dot C_(j_1 j_2) C_(j_3 j_4) dots.c C_(j_(n-k-1) j_(n-k))
  $
  причём все коэффициенты равны $1$.
]

= Доказательство по шагам

== Шаг 1: Общая структура — функция от $(bold(mu), bold(C))$

*Утверждение:* $E[X_1 X_2 dots.c X_n] = h(bold(mu), bold(C))$

*Обоснование:*

Распределение гауссовского вектора полностью определяется парой $(bold(mu), bold(C))$.

Следовательно, любой момент — функция только этих параметров:
$
E[X_1 X_2 dots.c X_n] = h(bold(mu), bold(C))
$

*Размерностный анализ:*

- $[E[X_1 dots.c X_n]] = [X]^n$
- $[mu_i] = [X]$
- $[C_(i j)] = [X]^2$

$arrow.r.double$ Каждое слагаемое содержит $k$ множителей $mu$ и $(n-k)/2$ множителей $C$,
где $k + 2 dot (n-k)/2 = n$, т.е. $k$ и $n$ одной чётности.

--------------------------------------------------------------------------------

== Шаг 2: Структура зависимости от $bold(mu)$

*Утверждение:* $h(bold(mu), bold(C))$ — полином по $mu_1, dots, mu_n$.

*Доказательство:*

Запишем $X_i = mu_i + Y_i$, где $Y_i$ — центрированные ($E[Y_i] = 0$).

$
E[X_1 dots.c X_n] = E[(mu_1 + Y_1)(mu_2 + Y_2) dots.c (mu_n + Y_n)]
$

Раскрываем скобки:
$
= sum_(S subset.eq {1, dots, n}) product_(i in S) mu_i dot E[product_(j in.not S) Y_j]
$

*Пример для $n = 3$:*
$
E[X_1 X_2 X_3] &= mu_1 mu_2 mu_3 \
&+ mu_1 E[Y_2 Y_3] + mu_2 E[Y_1 Y_3] + mu_3 E[Y_1 Y_2] \
&+ E[Y_1 Y_2 Y_3]
$

Поскольку $E[Y_1 Y_2 Y_3] = 0$ (нечётный момент центрированных), получаем:
$
E[X_1 X_2 X_3] = mu_1 mu_2 mu_3 + mu_1 C_(23) + mu_2 C_(13) + mu_3 C_(12)
$

--------------------------------------------------------------------------------

== Шаг 3: От $bold(C)$ ничего, кроме $bold(C)$, не зависит — добавим шум

*Идея:* изменим ковариационную матрицу, добавив независимый шум.

Пусть $Z tilde cal(N)(0, 1)$ — независимый от $bold(X)$ шум.

Определим новый вектор:
$
tilde(X)_1 = X_1 + sqrt(t) dot Z, quad tilde(X)_i = X_i "для" i >= 2
$

*Как меняется ковариационная матрица?*

$
bold(C) = mat(
  C_(11), C_(12), dots;
  C_(21), C_(22), dots;
  dots.v, dots.v, dots.down;
)
quad arrow.r quad
tilde(bold(C)) = mat(
  C_(11) + t, C_(12), dots;
  C_(21), C_(22), dots;
  dots.v, dots.v, dots.down;
)
$

Меняется *только* $C_(11) arrow.r C_(11) + t$.

*Ключевое наблюдение:*

Момент $M(t) = E[tilde(X)_1^2 tilde(X)_2 dots.c tilde(X)_n]$ — аналитическая функция по $t$.

Производная:
$
(d M) / (d t) |_(t=0) = (partial h) / (partial C_(11))
$

Это показывает, что $h$ *гладко* зависит от элементов $bold(C)$,
причём зависимость полиномиальная (по размерности).

--------------------------------------------------------------------------------

== Шаг 4: Как $h$ зависит от $C_(12)$? Добавим одинаковый шум к $X_1$ и $X_2$

*Идея:* чтобы изменить *ковариацию* $C_(12)$, добавим *общий* шум.

Пусть $Z tilde cal(N)(0, 1)$ независим от $bold(X)$.

Определим:
$
tilde(X)_1 = X_1 + sqrt(t) dot Z, quad tilde(X)_2 = X_2 + sqrt(t) dot Z, quad tilde(X)_i = X_i "для" i >= 3
$

*Как меняется ковариационная матрица?*

$
bold(C) = mat(
  C_(11), C_(12), C_(13), dots;
  C_(21), C_(22), C_(23), dots;
  C_(31), C_(32), C_(33), dots;
  dots.v, dots.v, dots.v, dots.down;
)
$

$arrow.b$

$
tilde(bold(C)) = mat(
  C_(11) + t, C_(12) + t, C_(13), dots;
  C_(21) + t, C_(22) + t, C_(23), dots;
  C_(31), C_(32), C_(33), dots;
  dots.v, dots.v, dots.v, dots.down;
)
$

Изменились: $C_(11), C_(22), C_(12), C_(21)$ — все на $+t$.

*Вычислим производную:*

$
(d M) / (d t) |_(t=0) = (partial h) / (partial C_(11)) + (partial h) / (partial C_(22)) + 2 (partial h) / (partial C_(12))
$

*Альтернативно,* напрямую дифференцируя:

$
(d) / (d t) E[(X_1 + sqrt(t) Z)(X_2 + sqrt(t) Z) X_3 dots.c X_n] |_(t=0)
$

$
= E[1/(2 sqrt(t)) Z dot (X_2 + sqrt(t) Z) X_3 dots.c + (X_1 + sqrt(t) Z) dot 1/(2 sqrt(t)) Z dot X_3 dots.c] |_(t=0)
$

После вычисления пределов получаем выражение через моменты меньшего порядка.

*Сравнивая две формулы,* получаем рекуррентное соотношение на коэффициенты $h$.

--------------------------------------------------------------------------------

== Шаг 5: Доказательство того, что все коэффициенты равны 1

*Метод:* индукция по $n$ с использованием зашумления.

*База:* $n = 2$
$
E[X_1 X_2] = mu_1 mu_2 + C_(12)
$
Коэффициенты: $1$ при $mu_1 mu_2$ и $1$ при $C_(12)$. ✓

*Индуктивный переход:*

Рассмотрим момент $M = E[X_1^2 X_2 dots.c X_n]$ (для простоты).

Добавим шум к $X_1$: $tilde(X)_1 = X_1 + sqrt(t) Z$.

$
M(t) = E[(X_1 + sqrt(t) Z)^2 X_2 dots.c X_n]
$

$
= E[X_1^2 X_2 dots.c X_n] + t dot E[Z^2] dot E[X_2 dots.c X_n]
$

(используем независимость $Z$ от $X_2, dots, X_n$)

$
= M(0) + t dot E[X_2 dots.c X_n]
$

*С другой стороны,* по формуле $M = h(bold(mu), bold(C))$:

$
M(t) = h(bold(mu), bold(C)|_(C_(11) -> C_(11) + t))
$

$
(d M) / (d t) |_(t=0) = (partial h) / (partial C_(11))
$

*Сравниваем:*

$
(partial h) / (partial C_(11)) = E[X_2 dots.c X_n]
$

По предположению индукции, $E[X_2 dots.c X_n]$ имеет все коэффициенты равные $1$.

$arrow.r.double$ В $h$ коэффициент при каждом слагаемом, содержащем $C_(11)$, равен $1$.

Повторяя для всех $C_(i j)$, получаем: *все* коэффициенты равны $1$.


=  При чём здесь нормальное распределение?

#box(
  width: 100%,
  fill: rgb("#fff4e6"),
  inset: 12pt,
  radius: 4pt,
)[
  *Ключевой момент:* Мы использовали нормальность *только* в одном месте —
  
  *устойчивость относительно суммирования с шумом:*
  
  $
  X_i + sqrt(t) Z tilde cal(N)(mu_i, C_(i i) + t)
  $
  
  Гауссовский вектор *остаётся гауссовским* при добавлении независимого
  гауссовского шума.
]

*Геометрическая интерпретация:*

В пространстве $(X_1, Z)$ преобразование
$
tilde(X)_1 = X_1 + sqrt(t) Z = (1, sqrt(t)) dot vec(X_1, Z)
$
— это *проекция* на направление $(1, sqrt(t))$.

По аксиоме Гермеля–Максвелла:
- Совместное распределение $(X_1, Z)$ изотропно (инвариантно к поворотам)
- Проекция на любое направление — снова гауссова

*Для негауссовских распределений:*

- Добавление шума *не сохраняет* форму распределения
- Появляются ненулевые кумулянты $kappa_3, kappa_4, dots$
- Формула Иссерлиса *неверна*


#box(
  width: 100%,
  fill: rgb("#e8f8e8"),
  inset: 12pt,
  radius: 4pt,
)[
  *Теорема Иссерлиса:*
  
  Для гауссовского вектора $(X_1, dots, X_n) tilde cal(N)(bold(mu), bold(C))$:
  
  $
  E[X_1 X_2 dots.c X_n] = sum_("разбиения") product_("одиночки" {i}) mu_i dot product_("пары" (i,j)) C_(i j)
  $
  
  где сумма берётся по всем способам разбить $\{1, dots, n\}$ на:
  - «одиночки» $arrow.r$ вносят $mu_i$
  - «пары» $arrow.r$ вносят $C_(i j)$
  
  *Все коэффициенты равны 1.*
]

*Пример:* $E[X_1 X_2 X_3 X_4]$ для центрированного случая ($bold(mu) = bold(0)$):

$
E[X_1 X_2 X_3 X_4] = C_(12) C_(34) + C_(13) C_(24) + C_(14) C_(23)
$

Три слагаемых = три способа разбить $\{1, 2, 3, 4\}$ на две пары.
